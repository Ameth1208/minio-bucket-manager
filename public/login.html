<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In - MinIO Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: { sans: ["Inter", "sans-serif"] },
            colors: {
              dark: { 950: "#020617", 900: "#0f172a", 800: "#1e293b" },
            },
            animation: { "fade-in": "fadeIn 0.2s ease-out" },
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0", transform: "translateY(-5px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
            },
          },
        },
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      .toggle-password-icon {
        cursor: pointer;
        transition: color 0.2s;
      }
      .toggle-password-icon:hover {
        color: #e11d48;
      }
    </style>
  </head>
  <body
    class="bg-[#fcfcfd] dark:bg-dark-950 flex flex-col min-h-screen text-slate-800 dark:text-slate-200 font-sans selection:bg-rose-500/30 transition-colors duration-300"
  >
    <!-- Top Bar -->
    <nav class="absolute top-0 right-0 w-full p-6 flex justify-end gap-3 z-10">
      <!-- Lang Menu -->
      <div class="relative" id="langMenu">
        <button
          onclick="toggleLangMenu()"
          class="flex items-center gap-2 bg-white dark:bg-dark-900 border border-slate-200 dark:border-dark-800 hover:border-slate-300 dark:hover:border-dark-700 rounded-lg px-3 py-2 transition-all shadow-sm"
        >
          <iconify-icon
            id="currentFlag"
            icon="flagpack:us"
            width="18"
          ></iconify-icon>
          <span
            id="currentLangLabel"
            class="text-xs font-bold text-slate-600 dark:text-slate-300"
            >EN</span
          >
        </button>
        <div
          id="langDropdown"
          class="absolute right-0 mt-2 w-40 bg-white dark:bg-dark-900 rounded-xl shadow-xl border border-slate-200 dark:border-dark-800 hidden py-1.5 overflow-hidden animate-fade-in"
        >
          <button
            onclick="setLanguage('en')"
            class="w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-50 dark:hover:bg-dark-800 text-sm"
          >
            <iconify-icon icon="flagpack:us" width="18"></iconify-icon> English
          </button>
          <button
            onclick="setLanguage('es')"
            class="w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-50 dark:hover:bg-dark-800 text-sm"
          >
            <iconify-icon icon="flagpack:es" width="18"></iconify-icon> Español
          </button>
          <button
            onclick="setLanguage('pt')"
            class="w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-50 dark:hover:bg-dark-800 text-sm"
          >
            <iconify-icon icon="flagpack:br" width="18"></iconify-icon>
            Português
          </button>
          <button
            onclick="setLanguage('fr')"
            class="w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-50 dark:hover:bg-dark-800 text-sm"
          >
            <iconify-icon icon="flagpack:fr" width="18"></iconify-icon> Français
          </button>
          <button
            onclick="setLanguage('ja')"
            class="w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-50 dark:hover:bg-dark-800 text-sm"
          >
            <iconify-icon icon="flagpack:jp" width="18"></iconify-icon> 日本語
          </button>
          <button
            onclick="setLanguage('zh')"
            class="w-full flex items-center gap-3 px-4 py-2 hover:bg-slate-50 dark:hover:bg-dark-800 text-sm"
          >
            <iconify-icon icon="flagpack:cn" width="18"></iconify-icon> 中文
          </button>
        </div>
      </div>

      <!-- Theme Toggle -->
      <button
        id="themeToggle"
        class="bg-white dark:bg-dark-900 border border-slate-200 dark:border-dark-800 hover:border-slate-300 dark:hover:border-dark-700 p-2 rounded-lg transition-all shadow-sm text-slate-500 dark:text-yellow-400"
      >
        <svg
          class="w-5 h-5 hidden dark:block"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
          ></path>
        </svg>
        <svg
          class="w-5 h-5 block dark:hidden"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
          ></path>
        </svg>
      </button>
    </nav>

    <!-- Content -->
    <div class="flex-grow flex items-center justify-center p-4">
      <div class="w-full max-w-sm">
        <!-- Logo Header -->
        <div class="flex flex-col items-center mb-10">
          <div
            class="bg-rose-500 p-3 rounded-2xl mb-5 shadow-xl shadow-rose-500/20 transform hover:scale-105 transition-transform duration-300"
          >
            <svg
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="white"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"
              ></path>
              <polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline>
              <polyline points="7.5 19.79 12 17.19 16.5 19.79"></polyline>
              <polyline points="12 12 12 22"></polyline>
              <polyline points="12 12 2 7"></polyline>
              <polyline points="12 12 22 7"></polyline>
            </svg>
          </div>
          <h1
            class="text-2xl font-bold tracking-tight text-slate-900 dark:text-white"
            data-i18n="welcome"
          >
            MinIO Manager
          </h1>
          <p
            class="text-sm text-slate-500 dark:text-slate-400 mt-1"
            data-i18n="subtitle"
          >
            Sign in to manage your storage
          </p>
        </div>

        <!-- Login Card -->
        <form
          id="loginForm"
          class="bg-white dark:bg-dark-900 border border-slate-200 dark:border-dark-800 rounded-3xl p-8 shadow-sm"
        >
          <div class="space-y-6">
            <div>
              <label
                class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-2"
                for="username"
                data-i18n="username"
              >
                Username
              </label>
              <input
                class="w-full bg-slate-50 dark:bg-dark-950 border border-slate-200 dark:border-dark-800 rounded-xl px-4 py-3.5 text-sm focus:outline-none focus:border-rose-500 dark:focus:border-rose-500 transition-colors"
                id="username"
                type="text"
                placeholder="admin"
                required
              />
            </div>

            <div>
              <label
                class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-widest mb-2"
                for="password"
                data-i18n="password"
              >
                Password
              </label>
              <div class="relative">
                <input
                  class="w-full bg-slate-50 dark:bg-dark-950 border border-slate-200 dark:border-dark-800 rounded-xl pl-4 pr-12 py-3.5 text-sm focus:outline-none focus:border-rose-500 dark:focus:border-rose-500 transition-colors"
                  id="password"
                  type="password"
                  placeholder="••••••••"
                  required
                />
                <div class="absolute inset-y-0 right-0 flex items-center pr-4">
                  <iconify-icon
                    id="togglePassword"
                    icon="solar:eye-closed-bold"
                    class="text-slate-400 toggle-password-icon"
                    width="20"
                  ></iconify-icon>
                </div>
              </div>
            </div>
          </div>

          <div class="mt-8">
            <button
              type="submit"
              class="w-full bg-rose-600 hover:bg-rose-700 text-white font-semibold py-3.5 px-4 rounded-xl transition-all active:scale-[0.98] shadow-lg shadow-rose-600/20"
              data-i18n="signin"
            >
              Sign In
            </button>
          </div>

          <!-- Error Message -->
          <div
            id="errorMsg"
            class="mt-6 flex items-center gap-2 text-rose-600 dark:text-rose-400 text-sm justify-center bg-rose-50 dark:bg-rose-900/20 py-2.5 px-3 rounded-xl border border-rose-100 dark:border-rose-900/30 hidden animate-fade-in"
          >
            <iconify-icon
              icon="solar:danger-circle-bold"
              width="18"
            ></iconify-icon>
            <span id="errorText">Invalid credentials</span>
          </div>
        </form>

        <p class="text-center text-slate-400 dark:text-slate-600 text-xs mt-8">
          &copy; 2026 MinIO Manager. Secure Access.
        </p>
      </div>
    </div>

    <script>
      // --- Translations ---
      const translations = {
        en: {
          welcome: "MinIO Manager",
          subtitle: "Sign in to manage your storage",
          username: "Username",
          password: "Password",
          signin: "Sign In",
          error: "Invalid credentials",
        },
        es: {
          welcome: "Gestor MinIO",
          subtitle: "Inicia sesión para gestionar",
          username: "Usuario",
          password: "Password",
          signin: "Entrar",
          error: "Credenciales inválidas",
        },
        pt: {
          welcome: "Gerenciador MinIO",
          subtitle: "Faça login para gerenciar",
          username: "Usuário",
          password: "Senha",
          signin: "Entrar",
          error: "Credenciais inválidas",
        },
        fr: {
          welcome: "Gestionnaire MinIO",
          subtitle: "Connectez-vous pour gérer",
          username: "Utilisateur",
          password: "Mot de passe",
          signin: "Connexion",
          error: "Identifiants invalides",
        },
        ja: {
          welcome: "MinIOマネージャー",
          subtitle: "管理するにはログインしてください",
          username: "ユーザー名",
          password: "パスワード",
          signin: "ログイン",
          error: "資格情報が無効です",
        },
        zh: {
          welcome: "MinIO 管理器",
          subtitle: "登录以管理您的存储",
          username: "用户名",
          password: "密码",
          signin: "登录",
          error: "凭证无效",
        },
      };

      const flags = {
        en: "flagpack:us",
        es: "flagpack:es",
        pt: "flagpack:br",
        fr: "flagpack:fr",
        ja: "flagpack:jp",
        zh: "flagpack:cn",
      };
      let currentLang = localStorage.getItem("lang") || "en";

      // --- Logic ---
      function initTheme() {
        const savedTheme = localStorage.getItem("theme");
        if (
          savedTheme === "dark" ||
          (!savedTheme &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        )
          document.documentElement.classList.add("dark");
        else document.documentElement.classList.remove("dark");
      }

      function toggleTheme() {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }

      function toggleLangMenu() {
        document.getElementById("langDropdown").classList.toggle("hidden");
      }
      window.onclick = (e) => {
        if (!e.target.closest("#langMenu"))
          document.getElementById("langDropdown").classList.add("hidden");
      };

      function setLanguage(lang) {
        currentLang = lang;
        localStorage.setItem("lang", lang);
        document
          .getElementById("currentFlag")
          .setAttribute("icon", flags[lang]);
        document.getElementById("currentLangLabel").innerText =
          lang.toUpperCase();
        document.getElementById("langDropdown").classList.add("hidden");

        // Translate
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          if (translations[lang][key]) el.innerText = translations[lang][key];
        });
      }

      // Toggle Password
      const passInput = document.getElementById("password");
      const passIcon = document.getElementById("togglePassword");
      passIcon.parentElement.addEventListener("click", () => {
        const isPass = passInput.type === "password";
        passInput.type = isPass ? "text" : "password";
        passIcon.setAttribute(
          "icon",
          isPass ? "solar:eye-bold" : "solar:eye-closed-bold"
        );
        passIcon.classList.toggle("text-rose-500");
      });

      // Init
      initTheme();
      setLanguage(currentLang);
      document
        .getElementById("themeToggle")
        .addEventListener("click", toggleTheme);

      // Login Submit
      document
        .getElementById("loginForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const username = document.getElementById("username").value;
          const password = passInput.value;
          const errorContainer = document.getElementById("errorMsg");
          const errorText = document.getElementById("errorText");
          const btn = e.target.querySelector("button");
          const originalBtnText = btn.innerText;

          errorContainer.classList.add("hidden");
          btn.innerHTML = `<iconify-icon icon="line-md:loading-twotone-loop" width="24"></iconify-icon>`;
          btn.disabled = true;

          try {
            const res = await fetch("/api/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ username, password }),
            });

            if (res.ok) {
              window.location.href = "/manager";
            } else {
              errorText.innerText = translations[currentLang].error;
              errorContainer.classList.remove("hidden");
              btn.innerHTML = originalBtnText;
              btn.disabled = false;
            }
          } catch (err) {
            console.error(err);
            errorText.innerText = "Connection error";
            errorContainer.classList.remove("hidden");
            btn.innerHTML = originalBtnText;
            btn.disabled = false;
          }
        });
    </script>
  </body>
</html>
